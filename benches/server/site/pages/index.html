<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZX Server-Side Keyed</title>
    <link href="/css/currentStyle.css" rel="stylesheet"/>
</head>
<body>
    <div id="main">
        <div class="container">
            <div class="jumbotron">
                <div class="row">
                    <div class="col-md-6">
                        <h1>ZX Server-Side "keyed"</h1>
                    </div>
                    <div class="col-md-6">
                        <div class="row">
                            <div class="col-sm-6 smallpad">
                                <button type="button" class="btn btn-primary btn-block" id="run">
                                    Create 1,000 rows
                                </button>
                            </div>
                            <div class="col-sm-6 smallpad">
                                <button type="button" class="btn btn-primary btn-block" id="runlots">
                                    Create 10,000 rows
                                </button>
                            </div>
                            <div class="col-sm-6 smallpad">
                                <button type="button" class="btn btn-primary btn-block" id="add">
                                    Append 1,000 rows
                                </button>
                            </div>
                            <div class="col-sm-6 smallpad">
                                <button type="button" class="btn btn-primary btn-block" id="update">
                                    Update every 10th row
                                </button>
                            </div>
                            <div class="col-sm-6 smallpad">
                                <button type="button" class="btn btn-primary btn-block" id="clear">
                                    Clear
                                </button>
                            </div>
                            <div class="col-sm-6 smallpad">
                                <button type="button" class="btn btn-primary btn-block" id="swaprows">
                                    Swap Rows
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <table class="table table-hover table-striped test-data">
                <tbody id="tbody">
                    {content}
                </tbody>
            </table>
            <span class="preloadicon glyphicon glyphicon-remove" aria-hidden="true"></span>
        </div>
    </div>
    
    <script>
        // Client-side JavaScript to handle button clicks and make server requests
        let selected = null;
        
        document.getElementById('run').addEventListener('click', () => performAction('run'));
        document.getElementById('runlots').addEventListener('click', () => performAction('runlots'));
        document.getElementById('add').addEventListener('click', () => performAction('add'));
        document.getElementById('update').addEventListener('click', () => performAction('update'));
        document.getElementById('clear').addEventListener('click', () => performAction('clear'));
        document.getElementById('swaprows').addEventListener('click', () => performAction('swaprows'));
        
        async function performAction(action) {
            const response = await fetch(`/api/${action}`, { method: 'POST' });
            const html = await response.text();
            document.getElementById('tbody').innerHTML = html;
            selected = null;
        }
        
        document.getElementById('tbody').addEventListener('click', async (e) => {
            if (e.target.tagName === 'A') {
                e.preventDefault();
                const row = e.target.closest('tr');
                if (!row) return;
                
                if (e.target.classList.contains('select-link')) {
                    // Select row
                    if (selected) {
                        selected.classList.remove('danger');
                    }
                    row.classList.add('danger');
                    selected = row;
                } else if (e.target.closest('.remove-link')) {
                    // Remove row
                    const id = row.getAttribute('data-id');
                    await fetch(`/api/remove/${id}`, { method: 'POST' });
                    row.remove();
                }
            }
        });
    </script>
</body>
</html>
